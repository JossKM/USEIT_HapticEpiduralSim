<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Haptic Rendering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter17-haptics.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Haptic Rendering </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section17-1"></a>
Introduction</h1>
<p>In the following sections we introduce the basic classes and algorithms that are used to connect a haptic device to a virtual world.</p>
<h1><a class="anchor" id="section17-2"></a>
Tools</h1>
<p>A tool is a 3D object that is used to connect, model, and display a haptic device in a virtual world. A tool is modelled graphically by one or more contact spheres called haptic points (<a class="el" href="classchai3d_1_1c_haptic_point.html">cHapticPoint</a>) that model the interactions between the haptic device and the environment. The simplest tool (<a class="el" href="classchai3d_1_1c_tool_cursor.html">cToolCursor</a>) uses a single sphere, whereas a gripper tool (<a class="el" href="classchai3d_1_1c_tool_gripper.html">cToolGripper</a>) uses two or more contact points to model a grasping-like interaction (thumb and finger).</p>
<p>A set of force rendering algorithms (<a class="el" href="classchai3d_1_1c_algorithm_finger_proxy.html">cAlgorithmFingerProxy</a> and <a class="el" href="classchai3d_1_1c_algorithm_potential_field.html">cAlgorithmPotentialField</a>) that compute the interaction forces between the haptic point and the environment is associated with each haptic point (<a class="el" href="classchai3d_1_1c_haptic_point.html">cHapticPoint</a>). The type of object encountered determines which of the force rendering algorithms is used.</p>
<p>Once all contact forces have been computed at each haptic point of the tool, the resulting forces are combined together and converted into a force, torque, and gripper force that are sent to the haptic device.</p>
<div class="image">
<img src="fig-tool.png" alt="fig-tool.png"/>
<div class="caption">
Two tools each composed of two haptic points grasping mesh objects (See demo 06-ODE-exploration).</div></div>
<p>The following code illustrates how to create a single point contact tool (cursor) and connect it to a haptic device.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create 3D virtual tool</span></div><div class="line"><a class="code" href="classchai3d_1_1c_tool_cursor.html">cToolCursor</a>* tool;</div><div class="line">tool = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_tool_cursor.html">cToolCursor</a>(world);</div><div class="line">world-&gt;addChild(tool);</div><div class="line"></div><div class="line"><span class="comment">// attach haptic device to virtual tool</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a763239e1780f45f546d85240d3324867">setHapticDevice</a>(hapticDevice);</div></div><!-- fragment --><p>Once a tool has been instantiated, we create a haptic thread that continuously reads the position of haptic device, computes the interaction forces between the tool and the environment, and send the computed forces back to the haptic device. If any additional behaviours need to be modelled (e.g. picking or moving an object), these are generally implemented in the same haptics loop. To get a better understanding of these features, we invite you to explore the different CHAI3D examples.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> updateHaptics(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">// simulation in now running</span></div><div class="line">    simulationRunning  = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">// main haptic simulation loop</span></div><div class="line">    <span class="keywordflow">while</span>(simulationRunning)</div><div class="line">    {</div><div class="line">        <span class="comment">// compute global reference frames for each object</span></div><div class="line">        world-&gt;computeGlobalPositions(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// update position and orientation of tool</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a68152df29e432069d16ca2aa2e1b5c71">updateFromDevice</a>();</div><div class="line"></div><div class="line">        <span class="comment">// compute interaction forces</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_tool_cursor.html#a44a8e38e7ff64541119dd2832eb79776">computeInteractionForces</a>();</div><div class="line"></div><div class="line">        <span class="comment">// send forces to haptic device</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#ae85e757389b7f287eb50f4df44c5ca90">applyToDevice</a>();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>When the physical workspace of the haptic device differs from the workspace size of the virtual world, a scale factor must be introduced. The scale factor is programmed by assigning a desired workspace size to the tool.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// map physical workspace of haptic device to a simulation workspace.</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a36477425bdc290e6020c72d420305e18">setWorkspaceRadius</a>(1.5);</div></div><!-- fragment --><p>As haptic devices differ from one and other (e.g. size, range of forces, maximum closed loop stiffness), it is important to consult their physical characteristics before assigning haptic properties to the virtual environment to prevent instabilities in the haptic rendering.</p>
<p>The following code sample illustrates how the material stiffness property of an object is programmed according to the specifications of the haptic device. In this example, we take into account the maximum closed loop stiffness supported by the haptics device and the workspace scale factor between the tool and the device.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// map physical workspace of haptic device to a simulation workspace.</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a36477425bdc290e6020c72d420305e18">setWorkspaceRadius</a>(1.3);</div><div class="line"></div><div class="line"><span class="comment">// retrieve information from haptic device</span></div><div class="line"><a class="code" href="structchai3d_1_1c_haptic_device_info.html">cHapticDeviceInfo</a> info;</div><div class="line">info = hapticDevice-&gt;getSpecifications();</div><div class="line"></div><div class="line"><span class="comment">// read scale factor between physical workspace of haptic device and simulation workspace</span></div><div class="line"><span class="keywordtype">double</span> workspaceScaleFactor = tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#af16ee038962aaf6e6b5028786864afc3">getWorkspaceScaleFactor</a>();</div><div class="line"></div><div class="line"><span class="comment">// define maximum scaled stiffness that can be handled by current haptic device.</span></div><div class="line">stiffnessMax = info.m_maxForceStiffness / workspaceScaleFactor;</div></div><!-- fragment --><h1><a class="anchor" id="section17-3"></a>
Haptic Points</h1>
<p>As illustrated in the above figure, a haptic tool is composed of a set of haptic points (contact spheres) that model the interaction forces between the tool and the environment. When a tool computes the interaction forces, the rendering algorithm loops through every haptic point and computes all local contributions independently.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// compute interaction forces</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_tool_cursor.html#a44a8e38e7ff64541119dd2832eb79776">computeInteractionForces</a>();</div></div><!-- fragment --><h1><a class="anchor" id="section17-4"></a>
Force Models</h1>
<p>The methodologies that are used to compute the interaction forces at these points are called the <b>force rendering algorithms</b>. When the interaction forces are computed for a given tool, each haptic point parses the entire world (or scenegraph) for each algorithm and computes these forces. CHAI3D currently implements two force models, namely the <b>potential field</b> and the <b>finger-proxy</b> models.</p>
<p>Potential fields are easy to implement and require a small amount of CPU to operate. On the flip side, they do have limitations which have to be handled with care to avoid unwanted artefacts or instabilities (e.g. pop-through effects across thin object, discontinuities at corners, etc...) The finger-proxy addresses many of these problems, but at the cost of a more computationally expensive collision detection algorithms. More information about these algorithms are presented in the following subsections.</p>
<p>In practice, both approaches can be combined together to create rich environments while still maintaining the real-time performances needed to guaranty a stable behaviour of the haptic device.</p>
<h2><a class="anchor" id="subsection17-4-1"></a>
Potential-Field Models</h2>
<p>Additional haptic effects can also be activated and adjusted through the material property class. Haptic effects use potential field algorithms which are also supported on any generic shape object. Note that the magnetic effect is not currently supported on mesh objects.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a haptic stick-slip effect</span></div><div class="line">mesh-&gt;createEffectStickSlip();</div><div class="line"></div><div class="line"><span class="comment">// set haptic properties</span></div><div class="line">mesh-&gt;m_material-&gt;setStickSlipForceMax(5.0);</div><div class="line">mesh-&gt;m_material-&gt;setStickSlipStiffness(1000);</div></div><!-- fragment --><h2><a class="anchor" id="subsection17-4-2"></a>
Finger-Proxy Models</h2>
<div class="image">
<img src="fig-mesh-proxy.png" alt="fig-mesh-proxy.png"/>
<div class="caption">
Haptic rendering of mesh objects.</div></div>
<p>To haptically render mesh objects, CHAI3D uses a virtual "finger-proxy" algorithm developed by Ruspini and Khatib, similar to the "god-object" proposed by Zilles and Salisbury. The virtual proxy is a representative object that substitutes for the physical finger or probe in the virtual environment.</p>
<div class="image">
<img src="fig-mesh-ruspini.png" alt="fig-mesh-ruspini.png"/>
<div class="caption">
Finger-proxy algorithm by Ruspini and Khatib.</div></div>
<p>The above figure illustrates the motion of the virtual proxy, as the haptic devices's position is altered. The motion of the proxy attempts to always move toward a goal. When unobstructed, the proxy moves directly towards the goal. When the proxy encounters an obstacle, direct motion is not possible, but the proxy may still be able to reduce the distance to the goal by moving along one or more of the constraint surfaces. The motion is chosen to locally minimize the distance to the goal. When the proxy is unable to decrease its distance to the goal, it stops at the local minimum configuration. Forces are computed by modelling a virtual spring between the position of the haptic device and the proxy. The stiffness of the spring is defined in the material property.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create collision detector</span></div><div class="line">mesh-&gt;createAABBCollisionDetector(toolRadius);</div><div class="line"></div><div class="line"><span class="comment">// set haptic properties</span></div><div class="line">mesh-&gt;m_material-&gt;setStiffness(1000);</div><div class="line">mesh-&gt;m_material-&gt;setStaticFriction(0.3);</div><div class="line">mesh-&gt;m_material-&gt;setDynamicFriction(0.4);</div></div><!-- fragment --><h1><a class="anchor" id="section17-5"></a>
Contact Information</h1>
<h2><a class="anchor" id="subsection17-5-1"></a>
Interaction Events</h2>
<p>Every time a haptic point encounters an object with an activated haptic effect, an interaction event is returned. Each interaction event reports a reference to the object, the position of the tool at time of interaction, and the computed force.</p>
<h2><a class="anchor" id="subsection17-5-2"></a>
Collision Events</h2>
<p>Every time a contact between the proxy and and object occurs, a collision event is reported. A collision event contains useful information about the object, contact position, surface normal, etc...</p>
<p>The following example shows how to read the contact events from a haptic point.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// check if a contact event has occurred at contact point</span></div><div class="line"><span class="keywordflow">if</span> (tool-&gt;<a class="code" href="classchai3d_1_1c_tool_cursor.html#a689cecc5ce24d18f81bd71106d2200d6">m_hapticPoint</a>-&gt;<a class="code" href="classchai3d_1_1c_haptic_point.html#a777a76e476a4877b18543c2c6af4828d">getNumCollisionEvents</a>() &gt; 0)</div><div class="line">{</div><div class="line">    <span class="comment">// get contact event</span></div><div class="line">    <a class="code" href="structchai3d_1_1c_collision_event.html">cCollisionEvent</a>* collisionEvent = tool-&gt;<a class="code" href="classchai3d_1_1c_tool_cursor.html#a689cecc5ce24d18f81bd71106d2200d6">m_hapticPoint</a>-&gt;<a class="code" href="classchai3d_1_1c_haptic_point.html#a7430190f5c4629f329e5160ee8994116">getCollisionEvent</a>(0);</div><div class="line"></div><div class="line">    <span class="comment">// get object from contact event</span></div><div class="line">    <span class="keywordtype">object</span> = collisionEvent-&gt;<a class="code" href="structchai3d_1_1c_collision_event.html#a58f24c27eab47e307bb02d351ddfac3d">m_object</a>;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
