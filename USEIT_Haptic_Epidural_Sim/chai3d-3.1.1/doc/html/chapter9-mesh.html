<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Mesh Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter9-mesh.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Mesh Objects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section9-1"></a>
Introduction</h1>
<div class="image">
<img src="fig-mesh-model.png" alt="fig-mesh-model.png"/>
<div class="caption">
Mesh objects are shapes composed of triangles and vertices.</div></div>
<p> In CHAI3D, a polygon mesh is a collection of vertices and triangles that define the shape of a polyhedral object.</p>
<p>A <b>vertex</b> is a position along with other information such as <b>color</b>, <b>normal</b> vector and <b>texture coordinates</b>. Two vertices connected by a straight line become an <b>edge</b>. Three vertices, connected to each other by three edges, define a <b>triangle</b>, which is the simplest polygon in Euclidean space.</p>
<p>Mesh objects may be translated, rotated, or resized, and have one material and texture property assigned to them.</p>
<p>The following code illustrates how to create a textured square composed of 4 vertices and 2 triangles.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a mesh</span></div><div class="line"><span class="keywordtype">object</span> = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>();</div><div class="line"></div><div class="line"><span class="comment">// create a texture map</span></div><div class="line"><span class="keywordtype">object</span>-&gt;m_texture = <a class="code" href="classchai3d_1_1c_texture2d.html#aca2f11a46fd3fda5d88b1083800156ce">cTexture2d::create</a>();</div><div class="line"></div><div class="line"><span class="comment">// load a texture file</span></div><div class="line"><span class="keywordtype">object</span>-&gt;m_texture-&gt;loadFromFile(<span class="stringliteral">&quot;myTexture.jpg&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// enable texture mapping</span></div><div class="line">object1-&gt;setUseTexture(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// set material to white</span></div><div class="line">object1-&gt;m_material-&gt;setWhite();</div><div class="line"></div><div class="line"><span class="comment">// create vertices</span></div><div class="line"><span class="keywordtype">int</span> vertex0 = object0-&gt;newVertex();</div><div class="line"><span class="keywordtype">int</span> vertex1 = object0-&gt;newVertex();</div><div class="line"><span class="keywordtype">int</span> vertex2 = object0-&gt;newVertex();</div><div class="line"><span class="keywordtype">int</span> vertex3 = object0-&gt;newVertex();</div><div class="line"></div><div class="line"><span class="comment">// set position, surface normal, and texture coordinate for vertex 0</span></div><div class="line">object0-&gt;m_vertices-&gt;setLocalPos(vertex0,-0.1,-0.1, 0.0);</div><div class="line">object0-&gt;m_vertices-&gt;setNormal(vertex0, 0.0, 0.0, 1.0);</div><div class="line">object0-&gt;m_vertices-&gt;setTexCoord(vertex0, 0.0, 0.0);</div><div class="line"></div><div class="line"><span class="comment">// set position, surface normal, and texture coordinate for vertex 1</span></div><div class="line">object0-&gt;m_vertices-&gt;setLocalPos(vertex1, 0.1,-0.1, 0.0);</div><div class="line">object0-&gt;m_vertices-&gt;setNormal(vertex1, 0.0, 0.0, 1.0);</div><div class="line">object0-&gt;m_vertices-&gt;setTexCoord(vertex1, 1.0, 0.0);</div><div class="line"></div><div class="line"><span class="comment">// set position, surface normal, and texture coordinate for vertex 2</span></div><div class="line">object0-&gt;m_vertices-&gt;setLocalPos(vertex2, 0.1, 0.1, 0.0);</div><div class="line">object0-&gt;m_vertices-&gt;setNormal(vertex2, 0.0, 0.0, 1.0);</div><div class="line">object0-&gt;m_vertices-&gt;setTexCoord(vertex2, 1.0, 1.0);</div><div class="line"></div><div class="line"><span class="comment">// set position, surface normal, and texture coordinate for vertex 3</span></div><div class="line">object0-&gt;m_vertices-&gt;setLocalPos(vertex3,-0.1, 0.1, 0.0);</div><div class="line">object0-&gt;m_vertices-&gt;setNormal(vertex3, 0.0, 0.0, 1.0);</div><div class="line">object0-&gt;m_vertices-&gt;setTexCoord(vertex3, 0.0, 1.0);</div><div class="line"></div><div class="line"><span class="comment">// create two triangles by assigning their vertex IDs</span></div><div class="line">object0-&gt;m_triangles-&gt;newTriangle(vertex0, vertex1, vertex2);</div><div class="line">object0-&gt;m_triangles-&gt;newTriangle(vertex0, vertex2, vertex3);</div></div><!-- fragment --><h1><a class="anchor" id="section9-2"></a>
Rendering Options</h1>
<p>In the following section we review the different rendering options offered in CHAI3D:</p>
<h2><a class="anchor" id="subsection9-2-1"></a>
Materials</h2>
<p>Material properties define how a surface reflects light. They do this by defining color values much the same way that lights do. A material has a color values for diffuse (direct) light, ambient (scattered) light, and specular (reflected) light, but these values define how the components of light are reflected off the material surface. More information can be found in the section about materials.</p>
<p>The material property can be enabled or disabled, and requires the use of at least one light source in the world for the object to be visible.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a mesh</span></div><div class="line"><a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>* mesh = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>();</div><div class="line"></div><div class="line"><span class="comment">// add mesh to world</span></div><div class="line">world-&gt;addChild(mesh);</div><div class="line"></div><div class="line"><span class="comment">// build mesh using a cylinder primitive</span></div><div class="line"><a class="code" href="group__graphics.html#gae17c6c201c99a15a305690db8e06554b">cCreatePipe</a>(mesh, </div><div class="line">            0.15,</div><div class="line">            0.05,</div><div class="line">            0.06,</div><div class="line">            32,</div><div class="line">            1,</div><div class="line">            <a class="code" href="structchai3d_1_1c_vector3d.html">cVector3d</a>(-0.05,-0.20, 0.0), </div><div class="line">            <a class="code" href="structchai3d_1_1c_matrix3d.html">cMatrix3d</a>(<a class="code" href="group__math.html#ga1de804ba8ea4644835a583051c4cd087">cDegToRad</a>(0), <a class="code" href="group__math.html#ga1de804ba8ea4644835a583051c4cd087">cDegToRad</a>(0), <a class="code" href="group__math.html#ga1de804ba8ea4644835a583051c4cd087">cDegToRad</a>(170), <a class="code" href="namespacechai3d.html#af68390a23278829aa6c9ab0804c96ec8ae9c2ecc2fa97f831a48ddcebcb378dfb">C_EULER_ORDER_XYZ</a>)</div><div class="line">            );</div><div class="line"></div><div class="line"><span class="comment">// enable material property</span></div><div class="line">cylinder-&gt;setUseMaterial(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// (1) set material by simply assigning a color name</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setBlueCornflower();</div><div class="line"></div><div class="line"><span class="comment">// (2) or set material by assigning a color values for each component</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;m_ambient.set(0.2, 0.1, 0.1);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;m_diffuse.set(0.6, 0.3, 0.3);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;m_specular.set(1.0, 1.0, 1.0);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setShininess(10); </div></div><!-- fragment --><h2><a class="anchor" id="subsection9-2-2"></a>
Vertex Colors</h2>
<p>Different color values can be specified for each vertex of the mesh. If three vertices of a triangle share different colors, then the color at any point on the triangle is computed through interpolation of the three vertex colors.</p>
<div class="image">
<img src="fig-mesh-colors.png" alt="fig-mesh-colors.png"/>
<div class="caption">
Triangles and vertex colors.</div></div>
<p> If the material property is enabled, vertex colors are combined with the material color. It is common to set the material to white and assign colors to the different vertices to produce a desired light shading. If the material property is disabled, then all light sources are ignored and the pure vertex color is used to render the object.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a mesh</span></div><div class="line"><a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>* mesh = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>();</div><div class="line"></div><div class="line"><span class="comment">// add mesh to world</span></div><div class="line">world-&gt;addChild(mesh);</div><div class="line"></div><div class="line"><span class="comment">// create three new vertices</span></div><div class="line"><span class="keywordtype">int</span> vertex0 = mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a2e545ffff976c598f6df7a806c7574c7">newVertex</a>();</div><div class="line"><span class="keywordtype">int</span> vertex1 = mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a2e545ffff976c598f6df7a806c7574c7">newVertex</a>();</div><div class="line"><span class="keywordtype">int</span> vertex2 = mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a2e545ffff976c598f6df7a806c7574c7">newVertex</a>();</div><div class="line"></div><div class="line"><span class="comment">// set position of each vertex</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setLocalPos(vertex0, 0.0, 0.0, 0.0);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setLocalPos(vertex1, 0.0, 1.0, 0.0);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setLocalPos(vertex2, 1.0, 1.0, 0.0);</div><div class="line"></div><div class="line"><span class="comment">// assign color value to each vertex</span></div><div class="line"><a class="code" href="structchai3d_1_1c_colorf.html">cColorf</a> color(1.0, 0.2, 0.2);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setColor(vertex0, color);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setColor(vertex1, color);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a6fc0911c04ebf7c39436824100143213">m_vertices</a>-&gt;setColor(vertex2, color);</div><div class="line"></div><div class="line"><span class="comment">// create new triangle from vertices</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a29d7a4baae34a5e1595bbb9ab5e4b4a0">newTriangle</a>(vertex0, vertex1, vertex2);</div><div class="line"></div><div class="line"><span class="comment">// enable vertex colors</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a4d8b66c1ac2a6eda9b637da6060e4e9c">setUseVertexColors</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// compute surface normals</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#aaebc124cee7916a01f0a8f082125e435">computeAllNormals</a>();</div></div><!-- fragment --><h2><a class="anchor" id="subsection9-2-3"></a>
Texture Mapping</h2>
<div class="image">
<img src="fig-texture.png" alt="fig-texture.png"/>
<div class="caption">
Texture mapping.</div></div>
<p> A texture map is applied (mapped) to the surface of a shape or polygon. This process is akin to applying patterned paper to a plain white box. Every vertex in a polygon is assigned a texture coordinate (which in the 2d case is also known as a UV coordinate) either via explicit assignment or by procedural definition. Image sampling locations are then interpolated across the face of a polygon to produce a visual result that seems to have more richness than could otherwise be achieved with a limited number of polygons.</p>
<p>To understand how to create a texture in CHAI3D, see the first example at the top of this page.</p>
<h2><a class="anchor" id="subsection9-2-4"></a>
Wireframe</h2>
<p>Triangles can be rendered in either solid or wire mode.</p>
<div class="image">
<img src="fig-mesh-wireframe.png" alt="fig-mesh-wireframe.png"/>
<div class="caption">
(LEFT) Solid Mode. (RIGHT) Wireframe Mode.</div></div>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// enable wireframe rendering mode</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a8b2e702a870ec3d48ced1aed426603e9">setWireMode</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// enable solid rendering mode</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a8b2e702a870ec3d48ced1aed426603e9">setWireMode</a>(<span class="keyword">false</span>);</div></div><!-- fragment --><h2><a class="anchor" id="subsection9-2-5"></a>
Edges</h2>
<p>To render edges and triangles simultaneously, CHAI3D offers the option to display the triangles and overlay a subset of edges that are selected according to a desired minimum angle between adjacent triangles.</p>
<div class="image">
<img src="fig-mesh-edges.png" alt="fig-mesh-edges.png"/>
<div class="caption">
(LEFT) Solid and Edges. (RIGHT) Edges only.</div></div>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// compute all edges for which adjacent triangles have more than 40 degrees angle</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a4362787b48c98390c7bd7a02ab695811">computeAllEdges</a>(40);</div><div class="line"></div><div class="line"><span class="comment">// set line width of edges and color</span></div><div class="line"><a class="code" href="structchai3d_1_1c_colorf.html">cColorf</a> color;</div><div class="line">color.<a class="code" href="structchai3d_1_1c_colorf.html#a2418efccad2fa90d92d626d441983c84">setBlack</a>();</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a998916ec41029938b63ba18cb65288f0">setEdgeProperties</a>(1, color);  </div><div class="line"></div><div class="line"><span class="comment">// (1) enable surfaces and edges</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a2cc4133fb37f697648a866428bfb7dac">setShowTriangles</a>(<span class="keyword">true</span>);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a9482551a1c240e127ecebbe8e3e8c36f">setShowEdges</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// (2) enable edges only</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a2cc4133fb37f697648a866428bfb7dac">setShowTriangles</a>(<span class="keyword">false</span>);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a9482551a1c240e127ecebbe8e3e8c36f">setShowEdges</a>(<span class="keyword">true</span>);</div></div><!-- fragment --><h2><a class="anchor" id="subsection9-2-6"></a>
Face Culling</h2>
<p>Back-face culling determines whether a triangle of a mesh object is visible. It is a step in the graphical pipeline that tests whether the vertices in the triangle appear in clockwise order when projected onto the screen.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line">    </div><div class="line"><span class="comment">// enable culling</span></div><div class="line"><span class="keywordtype">object</span>-&gt;setUseCulling(<span class="keyword">true</span>);</div></div><!-- fragment --><p>If face culling is enabled, but the polygon projected on the screen has a counter-clockwise winding then it has been rotated to face away from the camera and will not be drawn.</p>
<p>The process makes rendering objects quicker and more efficient by reducing the number of polygons for the program to draw. For example, in a city street scene, there is generally no need to draw the polygons on the sides of the buildings facing away from the camera; they are completely occluded by the sides facing the camera.</p>
<p>In general, back-face culling can be assumed to produce no visible artifact in a rendered scene if it contains only closed and opaque geometry. In scenes containing transparent polygons, rear facing polygons may become visible through the process of alpha composition.</p>
<h2><a class="anchor" id="subsection9-2-7"></a>
Transparency, Translucency, and Blending</h2>
<div class="image">
<img src="fig-mesh-transparency.png" alt="fig-mesh-transparency.png"/>
<div class="caption">
Rendering the translucent lens of a camera.</div></div>
<p> A transparent physical material shows objects behind it as unobscured and doesn't reflect light off its surface. Clear glass is a nearly transparent material. Although glass allows most light to pass through unobscured, in reality it also reflects some light. A perfectly transparent material is completely invisible.</p>
<p>A translucent physical material shows objects behind it, but those objects are obscured by the translucent material. In addition, a translucent material reflects some of the light that hits it, making the material visible. Physical examples of translucent materials include sheer cloth, thin plastic, and smoked glass.</p>
<p>Transparent and translucent are often used synonymously. Materials that are neither transparent nor translucent are opaque.</p>
<p>Blending is OpenGL's mechanism for combining color already in the framebuffer with the color of the incoming primitive. The result of this combination is then stored back in the framebuffer. Blending is frequently used to simulate translucent physical materials. One example is rendering the smoked glass windshield of a car. The driver and interior are still visible, but they are obscured by the dark color of the smoked glass.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// enable multi-pass rendering to handle transparent objects</span></div><div class="line">camera-&gt;setUseMultipassTransparency(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// enable transparency to current mesh</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#ad3669f91ae691e812570fe304ef839a2">setUseCulling</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// assign a general transparency to the object</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a5ff5837130e7cda955229f62e4b56baf">setTransparencyLevel</a>(0.7);</div></div><!-- fragment --><h2><a class="anchor" id="subsection9-2-8"></a>
Surface Normals</h2>
<div class="image">
<img src="fig-mesh-normals.png" alt="fig-mesh-normals.png"/>
<div class="caption">
Rendering the vertex normals of a mesh.</div></div>
<p> When lighting is enabled in CHAI3D, the normal vectors are used to determine how much light is received at the specified vertex or surface. If the surface normals have not been defined, they can be computed for every triangle by taking the vector cross product of two edges of that triangle.</p>
<p>For debugging purposes, surface normals can be displayed using the following calls:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// compute all surface normals</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#aaebc124cee7916a01f0a8f082125e435">computeAllNormals</a>();</div><div class="line"></div><div class="line"><span class="comment">// set normal properties for display</span></div><div class="line"><a class="code" href="structchai3d_1_1c_colorf.html">cColorf</a> color;</div><div class="line">color.<a class="code" href="structchai3d_1_1c_colorf.html#ab68129862f9ff68f4fed3edae7c137b5">setOrangeTomato</a>();</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#a3e61068ed540517598a08c0ecadb4f31">setNormalsProperties</a>(0.01, color);</div><div class="line"></div><div class="line"><span class="comment">// display surface normals</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#afd3db5d7902cb2d21157b098f7cfcbd7">setShowNormals</a>(<span class="keyword">true</span>);</div></div><!-- fragment --><h1><a class="anchor" id="section9-3"></a>
Multi Mesh Objects</h1>
<h2><a class="anchor" id="subsection9-3-1"></a>
Introduction</h2>
<p>Since mesh objects only contains a single material and texture property each, creating meshes that use a collection of materials and textures requires using a different class called <a class="el" href="classchai3d_1_1c_multi_mesh.html">cMultiMesh</a> which concatenates a list of meshes together. By organizing triangles according to their material and texture property in separate mesh objects, it is possible to efficiently build and render complex objects with a rich set of properties.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a multi mesh object</span></div><div class="line"><a class="code" href="classchai3d_1_1c_multi_mesh.html">cMultiMesh</a>* multiMesh = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_multi_mesh.html">cMultiMesh</a>();</div><div class="line"></div><div class="line"><span class="comment">// add multi mesh object to world</span></div><div class="line">world-&gt;addChild(multiMesh);</div><div class="line"></div><div class="line"><span class="comment">// create a first mesh</span></div><div class="line"><a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>* mesh1 = multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a03fbb550f9c7006e90c92f73bbad3444">newMesh</a>();</div><div class="line"></div><div class="line"><span class="comment">// create a second mesh</span></div><div class="line"><a class="code" href="classchai3d_1_1c_mesh.html">cMesh</a>* mesh2 = multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a03fbb550f9c7006e90c92f73bbad3444">newMesh</a>();</div></div><!-- fragment --><h2><a class="anchor" id="subsection9-3-2"></a>
File Support</h2>
<p>CHAI3D supports 3DS, OBJ, and SLT file formats to import or export models. If you wish you import files of a different format, you can use applications such as <a href="http://www.blender.org" target="_blank">Blender</a> or <a href="http://www.sap.com/solution/lob/r-and-d/software/product-visualization/index.html" target="_blank">Visual Enterprise Author</a> (formerly known as Deep Exploration) to edit and convert files to desired formats.</p>
<div class="fragment"><div class="line"> <span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"> </div><div class="line"> <span class="comment">// load 3DS model file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a1cecc0525c3beb1e5c716bddc0e0f842">loadFromFile</a>(<span class="stringliteral">&quot;myModel.3ds&quot;</span>);</div><div class="line"></div><div class="line"> <span class="comment">// load OBJ model file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a1cecc0525c3beb1e5c716bddc0e0f842">loadFromFile</a>(<span class="stringliteral">&quot;myModel.obj&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// load STL model file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a1cecc0525c3beb1e5c716bddc0e0f842">loadFromFile</a>(<span class="stringliteral">&quot;myModel.stl&quot;</span>);</div><div class="line"> </div><div class="line"> <span class="comment">// save model to 3DS file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#ae882d7e18c94b832f82d835f2542a1b2">saveToFile</a>(<span class="stringliteral">&quot;myModel.3ds&quot;</span>);</div><div class="line"></div><div class="line"> <span class="comment">// save model to OBJ file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#ae882d7e18c94b832f82d835f2542a1b2">saveToFile</a>(<span class="stringliteral">&quot;myModel.obj&quot;</span>);</div><div class="line"></div><div class="line"> <span class="comment">// save model to STL file</span></div><div class="line"> multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#ae882d7e18c94b832f82d835f2542a1b2">saveToFile</a>(<span class="stringliteral">&quot;myModel.stl&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="section9-4"></a>
Collision Detection</h1>
<p>A collision detector is used to compute the intersection between a ray and any of the triangles that compose a mesh (or multi-mesh). In order for this operation to proceed quickly, CHAI3D uses a bounding volume hierarchy or BVH. A BVH is a tree structure on a set of geometric objects. All geometric objects are wrapped in bounding volumes that form the leaf nodes of the tree. These nodes are then grouped as small sets and enclosed within larger bounding volumes. These, in turn, are also grouped and enclosed within other larger bounding volumes in a recursive fashion, eventually resulting in a tree structure with a single bounding volume at the top of the tree. Bounding volume hierarchies are used to support several operations on sets of geometric objects efficiently, such as in collision detection for haptic interaction computation, ray tracing, or mouse selection.</p>
<div class="image">
<img src="fig-collision.png" alt="fig-collision.png"/>
<div class="caption">
Axis aligned bounding volume hierarchy.</div></div>
<p> In CHAI3D, bounding volume hierarchies must be generated <span style="text-decoration: underline;">after</span> the triangles have been defined. If the triangles are modified, or vertices moved, then the hierarchy must be computed again. When updating the collision tree, it is important to correctly include the radius of the largest haptic point used in the world. This information is used to create an envelope large enough to detect any interaction with contact points that have a radius smaller or equal to the defined threshold.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create axis aligned bounding volume hierarchy</span></div><div class="line">multiMesh-&gt;<a class="code" href="classchai3d_1_1c_multi_mesh.html#a03e6f1874df879bb4caf0fc3d8ad75d2">createAABBCollisionDetector</a>(toolRadius);</div></div><!-- fragment --><h1><a class="anchor" id="section9-5"></a>
Haptic Effects</h1>
<div class="image">
<img src="fig-mesh-proxy.png" alt="fig-mesh-proxy.png"/>
<div class="caption">
Haptic rendering of mesh objects.</div></div>
<p> To haptically render mesh objects, CHAI3D uses a virtual "finger-proxy" algorithm developed by Ruspini and Khatib, similar to the "god-object" proposed by Zilles and Salisbury. The virtual proxy is a representative object that substitutes for the physical finger or probe in the virtual environment.</p>
<div class="image">
<img src="fig-mesh-ruspini.png" alt="fig-mesh-ruspini.png"/>
<div class="caption">
Finger-proxy algorithm by Ruspini and Khatib.</div></div>
<p>The above figure illustrates the motion of the virtual proxy, as the haptic devices's position is altered. The motion of the proxy attemps to always move toward a goal. When unobstructed, the proxy moves directly towards the goal. When the proxy encounters an obstacle, direct motion is not possible, but the proxy may still be able to reduce the distance to the goal by moving along one or more of the constraint surfaces. The motion is chosen to locally minimize the distance to the goal. When the proxy is unable to decrease its distance to the goal, it stops at the local minimum configuration. Forces are computed by modelling a virtual spring between the position of the haptic device and the proxy. The stiffness of the spring is defined in the material property.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create collision detector</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_mesh.html#ab01624c8830bb6376a20c2d2f6c00638">createAABBCollisionDetector</a>(toolRadius);</div><div class="line"></div><div class="line"><span class="comment">// set haptic properties</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setStiffness(1000);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setStaticFriction(0.3);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setDynamicFriction(0.4);</div></div><!-- fragment --><p>Additional haptic effects can also be activated and adjusted through the material property class. Haptic effects use potential field algorithms which are also supported on any generic shape object. Please note that the magnetic effect is not currently supported on mesh objects.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a haptic stick-slip effect</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#aaf4ce3dfcd8befd826060d992691a09a">createEffectStickSlip</a>();</div><div class="line"></div><div class="line"><span class="comment">// set haptic properties</span></div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setStickSlipForceMax(5.0);</div><div class="line">mesh-&gt;<a class="code" href="classchai3d_1_1c_generic_object.html#a6485ea6b49048d44dc9cce9a0f42b2d6">m_material</a>-&gt;setStickSlipStiffness(1000);</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
